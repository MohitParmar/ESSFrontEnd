var app = angular.module("myApp", ["angularUtils.directives.dirPagination"]); app.controller("WeeklyOffCntroller", function ($scope, $http, $filter) { $http.defaults.headers.common.Authorization = "Basic " + $("#myEmpUnqId").val(), $scope.currentPage = 1, $scope.itemsPerPage = 25, $scope.alluserlist = [], $scope._Conpath = ""; var url_string = window.location.href, url = new URL(url_string), urlhost = url.hostname, urlprotocol = url.protocol; $(document).ready(function () { "undefined" != typeof _ConPath && (urlhost === _URLHostName ? $scope._Conpath = _ConPath : $scope._Conpath = urlprotocol + "//" + urlhost + "/api/") }), $scope.ResetView = function () { window.location.reload(!0) }, jQuery.support.cors = !0, $scope.GetRelesaseStratey = function () { var rel = new XMLHttpRequest; rel.open("GET", $scope._Conpath + "ReleaseStrategy/GetReleaseStrategy?releaseGroup=" + $("#releaseGroupCode").val() + "&empUnqId=" + $("#myEmpUnqId").val(), !0), rel.setRequestHeader("Accept", "application/json"), rel.onreadystatechange = function () { if (4 === rel.readyState) { var jsonvar1 = JSON.parse(rel.responseText); rlsarr = jsonvar1, $scope.rlsdata = jsonvar1, $scope.$digest() } }, rel.send() }, $scope.GetEmpInfo = function () { var e_Code = $("#myEmpUnqId").val(), emp = new XMLHttpRequest; emp.open("GET", $scope._Conpath + "Employee/GetEmployee?empunqid=" + e_Code, !0), emp.setRequestHeader("Accept", "application/json"), emp.onreadystatechange = function () { if (4 === emp.readyState) { var json = JSON.parse(emp.responseText); $scope.empdata = json, $scope.$digest(), $("#txtEmpCode").val($scope.empdata[0].empUnqId), $("#txtEmpName").val($scope.empdata[0].empName), $("#txtDesg").val($scope.empdata[0].desgName), $("#txtStat").val($scope.empdata[0].statName) } }, emp.send() }, $scope.YearValidate = function () { var chkFrom = document.getElementById("PresentWODt"), FromDate = chkFrom.value, date1 = new Date(FromDate), fyear = date1.getFullYear(), d = new Date, tyear = d.getFullYear(); return fyear > tyear || tyear > fyear ? (document.getElementById("MessageBox").innerHTML = "<div class='alert alert-danger alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Please Enter Valid Date of Current Month/Year.. </strong></div>", $("#MessageBox").show(), document.getElementById("PresentWODt").value = "", !1) : void $scope.ToValidate() }, $scope.ToValidate = function () { var chkFrom = document.getElementById("PresentWODt"), chkTo = document.getElementById("ChangeWODt"), FromDate = chkFrom.value, ToDate = chkTo.value; if ("" === FromDate) return document.getElementById("MessageBox").innerHTML = "<div class='alert alert-danger alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Please Select From Date First...</strong></div>", $("#MessageBox").show(), document.getElementById("PresentWODt").value = "", document.getElementById("ChangeWODt").value = "", !1; var date1 = new Date(FromDate), date2 = new Date(ToDate), fyear = date2.getFullYear(), d = new Date, tyear = d.getFullYear(); if (fyear > tyear) return alert("Please Enter Valid Date of Current Month/Year.. "), document.getElementById("ChangeWODt").value = "", !1; var diff = (date1 - date2) / 864e5 * -1 + 1; return "NaN" === diff || 0 >= diff ? (document.getElementById("MessageBox").innerHTML = "<div class='alert alert-danger alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Please Select Proper Dates for OD apply.</strong></div>", $("#MessageBox").show(), document.getElementById("PresentWODt").value = "", document.getElementById("ChangeWODt").value = "", !1) : date1 > date2 ? (document.getElementById("MessageBox").innerHTML = "<div class='alert alert-warning alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Please Enter Valid Date Range.. </strong></div>", $("#MessageBox").show(), !1) : !0 }, $scope.CreateWO = function (entity) { function storeTblValues() { var TableData = new Array; return TableData[0] = { yearMonth: yearmonth, leaveAppId: 0, compCode: $("#myCompCode").val(), wrkGrp: $("#myWrkGrp").val(), leaveAppItem: "1", leaveTypeCode: "WO", fromDt: FromDateTime, toDt: ToDateTime, totalDays: TotalDays, halfdayflag: HalfDayFlag, remarks: entity.Remarks, placeOfVisit: "", contactAddress: "" }, jsonObj.yearMonth = yearmonth, jsonObj.leaveAppId = 0, jsonObj.empUnqId = $("#myEmpUnqId").val(), jsonObj.compCode = $("#myCompCode").val(), jsonObj.wrkGrp = $("#myWrkGrp").val(), jsonObj.unitCode = $("#myUnitCode").val(), jsonObj.deptCode = $("#myDeptCode").val(), jsonObj.statCode = $("#myStatCode").val(), jsonObj.catCode = $("#myCatCode").val(), jsonObj.isHOD = $("#myIsHod").val(), jsonObj.releaseGroupCode = $("#releaseGroupCode").val(), jsonObj.releaseStrategy = "", jsonObj.releaseStatusCode = "", jsonObj.addDt = dt, jsonObj.addUser = $("#myEmpUnqId").val(), jsonObj.clientIp = $("#myIPAddress").val(), jsonObj.updDt = dt, jsonObj.updUser = null, jsonObj.remarks = null, jsonObj.parentId = 0, jsonObj.leaveApplicationDetails = TableData, jsonObj } document.getElementById("BtnCreate").disabled = !0; var d = new Date, dt = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate() + " " + d.getHours() + ":" + d.getMinutes(), year = d.getFullYear().toString(), month = d.getMonth() + 1, yearmonth = year + month.toString(), FromDateTime = entity.PresentWODt, ToDateTime = entity.ChangeWODt, HalfDayFlag = !1, TotalDays = "1", jsonObj = {}, TableData = storeTblValues(); TableData = JSON.stringify(TableData); var xhr = new XMLHttpRequest; xhr.open("POST", $scope._Conpath + "LeaveApplication/CreateLeaveApplication", !0), xhr.setRequestHeader("Content-type", "application/json"), xhr.onreadystatechange = function () { 4 === xhr.readyState && 201 === xhr.status ? (document.getElementById("MessageBox").innerHTML = "<div class='alert alert-success alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Week Off Change Application Created Sucessfully.. </strong></div>", $("#MessageBox").show(), document.getElementById("PresentWODt").value = "", document.getElementById("ChangeWODt").value = "") : (document.getElementById("MessageBox").innerHTML = "<div class='alert alert-danger alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Wekk Off Change Application Not Created Please try Again.. </strong></div>", $("#MessageBox").show(), document.getElementById("PresentWODt").value = "", document.getElementById("ChangeWODt").value = "") }, xhr.send(TableData) }, $scope.sort = function (keyname) { $scope.sortKey = keyname, $scope.reverse = !$scope.reverse } }), app.directive("datepicker", function () { return { restrict: "A", require: "ngModel", link: function (scope, elem, attrs, ngModelCtrl) { var updateModel = function (dateText) { scope.$apply(function () { ngModelCtrl.$setViewValue(dateText) }) }, options = { dateFormat: "yy-mm-dd", onSelect: function (dateText) { updateModel(dateText) } }; elem.datepicker(options) } } });