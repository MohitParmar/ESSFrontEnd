angular.module("myApp.Controllers").controller("LockDownController", ["$scope", "$http", function ($scope, $http) {
    $http.defaults.headers.common.Authorization = "Basic " + $("#myEmpUnqId").val(), $scope.alluserlist = [], $scope._Conpath = ""; var url_string = window.location.href, url = new URL(url_string), urlhost = url.hostname, urlprotocol = url.protocol; $(document).ready(function () { "undefined" != typeof _ConPath && (urlhost === _URLHostName ? $scope._Conpath = _ConPath : $scope._Conpath = urlprotocol + "//" + urlhost + "/api/") });
    $scope.loc = $("#myLoc").val(); jQuery.support.cors = true; $scope.ResetView = function () { window.location.reload(true); };
    $scope.GetRelesaseStratey = function () { var rel = new XMLHttpRequest; rel.open("GET", $scope._Conpath + "ReleaseStrategy/GetReleaseStrategy?releaseGroup=" + $("#releaseGroupCode").val() + "&empUnqId=" + $("#myEmpUnqId").val(), !0), rel.setRequestHeader("Accept", "application/json"), rel.onreadystatechange = function () { if (4 === rel.readyState) { var jsonvar1 = JSON.parse(rel.responseText); $scope.rlsdata = jsonvar1, $scope.$digest() } }, rel.send() };
    $scope.ToValidate = function () { var chkFrom = document.getElementById("FromDt"), chkTo = document.getElementById("ToDt"), FromDate = chkFrom.value, ToDate = chkTo.value; if ("" === FromDate) return document.getElementById("MessageBox").innerHTML = "<div class='alert alert-danger alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Please Select From Date First...</strong></div>", $("#MessageBox").show(), document.getElementById("FromDt").value = "", document.getElementById("ToDt").value = "", document.getElementById("TotalDays").value = "", document.getElementById("AdditionalRemarks").value = "", $("#Remarks option:first").attr("selected", !0), !1; var date1 = new Date(FromDate), date2 = new Date(ToDate), fyear = date2.getFullYear(), d = new Date, tyear = d.getFullYear(); if (fyear > tyear) return alert("Please Enter Valid Date of Current Month/Year.. "), document.getElementById("ToDt").value = "", !1; var diff = (date1 - date2) / 864e5 * -1 + 1; return "NaN" === diff || 0 >= diff ? (document.getElementById("MessageBox").innerHTML = "<div class='alert alert-danger alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Please Select Proper Dates for Leave apply.</strong></div>", $("#MessageBox").show(), document.getElementById("FromDt").value = "", document.getElementById("ToDt").value = "", document.getElementById("TotalDays").value = "", document.getElementById("AdditionalRemarks").value = "", $("#Remarks option:first").attr("selected", !0), !1) : ($("#TotalDays").text = diff, document.getElementById("TotalDays").value = diff, date1 > date2 ? (document.getElementById("MessageBox").innerHTML = "<div class='alert alert-warning alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Please Enter Valid Date Range.. </strong></div>", $("#MessageBox").show(), !1) : !0) };
    var c = 0; $scope.LeaveRequestData = function (entity) { function storeTblValues() { var count = 0; c += 1, count++ , $(".tempRow").remove(); var row = $("<tr><td><input type='hidden' name='AliasLastNames' value='" + c + "'>" + c + "</td><td><input type='hidden' name='AliasFirstNames' value='" + LeaveTypeCode + "'>" + LeaveTypeCode + "</td><td><input type='hidden' name='AliasFirstNames' value='" + FromDate + "'>" + FromDate + "</td><td><input type='hidden' name='AliasMiddleNames' value='" + ToDate + "'>" + ToDate + "</td><td><input type='hidden' name='AliasLastNames' value='" + Totaldays + "'>" + Totaldays + "</td><td><input type='hidden' name='AliasLastNames' value='" + Remarks + "'>" + Remarks + "</td><td><input type='hidden' name='AliasLastNames' value='" + AdditionalRemarks + "'>" + AdditionalRemarks + "</td></tr>"); $("#aliasTable").append(row); var TableData = new Array; return $("#aliasTable tr").each(function (row, tr) { TableData[row] = { yearMonth: yearmonth, leaveAppId: 0, compCode: $("#myCompCode").val(), wrkGrp: $("#myWrkGrp").val(), leaveAppItem: c, leaveTypeCode: $(tr).find("td:eq(1)").text(), fromDt: $(tr).find("td:eq(2)").text(), toDt: $(tr).find("td:eq(3)").text(), totalDays: $(tr).find("td:eq(4)").text(), remarks: $(tr).find("td:eq(5)").text(), additionalRemarks: $(tr).find("td:eq(6)").text() } }), TableData.shift(), jsonObj.yearMonth = yearmonth, jsonObj.leaveAppId = 0, jsonObj.empUnqId = $("#myEmpUnqId").val(), jsonObj.compCode = $("#myCompCode").val(), jsonObj.wrkGrp = $("#myWrkGrp").val(), jsonObj.unitCode = $("#myUnitCode").val(), jsonObj.deptCode = $("#myDeptCode").val(), jsonObj.statCode = $("#myStatCode").val(), jsonObj.catCode = $("#myCatCode").val(), jsonObj.releaseGroupCode = $("#releaseGroupCode").val(), jsonObj.releaseStrategy = "", jsonObj.releaseStatusCode = "", jsonObj.addDt = d, jsonObj.addUser = $("#myEmpUnqId").val(), jsonObj.updDt = d, jsonObj.updUser = null, jsonObj.remarks = null, jsonObj.leaveApplicationDetails = TableData, jsonObj } $scope.ToValidate(); var chk = !1; if ("undefined" == typeof entity || "undefined" == typeof entity.FromDt || "undefined" == typeof entity.Remarks || "undefined" == typeof entity.AdditionalRemarks) return alert("Please Fill All Required Details Step by Step..."), !1; var LeaveTypeCode = "LD", Totaldays = 0, Remarks = $("#Remarks option:selected").text(), AdditionalRemarks = entity.AdditionalRemarks.replace("'", ""), FromDate = entity.FromDt, chkTo = document.getElementById("ToDt"), ToDate = chkTo.value, date1 = new Date(FromDate), date2 = new Date(ToDate); if (date1 > date2) return document.getElementById("MessageBox").innerHTML = "<div class='alert alert-warning alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Please Enter Valid Date Range.. </strong></div>", $("#MessageBox").show(), !1; Totaldays = $("#TotalDays").val(); var d = new Date, year = d.getFullYear().toString(), month = d.getMonth() + 1, yearmonth = year + month.toString(), jsonObj = {}, TableData = storeTblValues(); TableData = JSON.stringify(TableData); var xhr1 = new XMLHttpRequest; xhr1.open("POST", $scope._Conpath + "LeaveValidate/IsValid", !0), xhr1.setRequestHeader("Content-type", "application/json"), xhr1.onreadystatechange = function () { if (4 === xhr1.readyState && 200 === xhr1.status) { var json = JSON.parse(xhr1.responseText); $scope.Vdata = json; var newarr = []; newarr[0] = $scope.Vdata; var dtlarr = []; dtlarr = newarr[0].leaveApplicationDetails; var dtlarrleg = dtlarr.length, table = document.getElementById("aliasTable"), rowCount = table.rows.length; table.deleteRow(rowCount - 1), dtlarrleg -= 1; var fdate = new Date(dtlarr[dtlarrleg].fromDt), tdate = new Date(dtlarr[dtlarrleg].toDt); fdate = fdate.getFullYear() + "/" + (fdate.getMonth() + 1) + "/" + fdate.getDate(), tdate = tdate.getFullYear() + "/" + (tdate.getMonth() + 1) + "/" + tdate.getDate(); var row = $("<tr><td style='text-align:center;'><input type='hidden' name='AliasFirstNames' value='" + dtlarr[dtlarrleg].leaveAppItem + "'>" + dtlarr[dtlarrleg].leaveAppItem + "</td><td style='text-align:center;'><input type='hidden' name='AliasFirstNames' value='" + dtlarr[dtlarrleg].leaveTypeCode + "'>" + dtlarr[dtlarrleg].leaveTypeCode + "</td><td style='text-align:center;'><input type='hidden' name='AliasMiddleNames' value='" + fdate + "'>" + fdate + "</td><td style='text-align:center;'><input type='hidden' name='AliasLastNames' value='" + tdate + "'>" + tdate + "</td><td style='text-align:center;'><input type='hidden' name='AliasLastNames' value='" + dtlarr[dtlarrleg].totalDays + "'>" + dtlarr[dtlarrleg].totalDays + "</td><td style='text-align:center;'><input type='hidden' name='AliasLastNames' value='" + dtlarr[dtlarrleg].remarks + "'>" + dtlarr[dtlarrleg].remarks + "</td><td style='text-align:center;'><input type='hidden' name='AliasLastNames' value='" + dtlarr[dtlarrleg].additionalRemarks + "'>" + dtlarr[dtlarrleg].additionalRemarks + "</td></tr>"); $("#aliasTable").append(row), document.getElementById("FromDt").value = "", document.getElementById("ToDt").value = "", document.getElementById("TotalDays").value = "", document.getElementById("AdditionalRemarks").value = "", $("#Remarks option:first").attr("selected", !0) } else if (400 === xhr1.status || 403 === xhr1.status || 404 === xhr1.status || 408 === xhr1.status || 500 === xhr1.status) { if (chk === !1) { var tables = document.getElementById("aliasTable"), rowCounts = tables.rows.length; tables.deleteRow(rowCounts - 1), chk = !0, c -= 1 } for (var str = xhr1.responseText.replace("[", "").replace("]", "").toString(), fields = str.split(","), er = "", i = 0; i < fields.length; i++)er = er + fields[i] + "<br/>"; document.getElementById("MessageBox").innerHTML = "<div class='alert alert-warning alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a> <strong>" + er + "</strong></div>", $("#MessageBox").show(), document.getElementById("FromDt").value = "", document.getElementById("ToDt").value = "", document.getElementById("TotalDays").value = "", document.getElementById("AdditionalRemarks").value = "", $("#Remarks option:first").attr("selected", !0) } }, xhr1.send(TableData) };
    $scope.createLeave = function () { function storeTblValues() { var TableData = new Array; return $("#aliasTable tr").each(function (row, tr) { TableData[row] = { yearMonth: yearmonth, leaveAppId: 0, compCode: $("#myCompCode").val(), wrkGrp: $("#myWrkGrp").val(), leaveAppItem: $(tr).find("td:eq(0)").text(), leaveTypeCode: $(tr).find("td:eq(1)").text(), fromDt: $(tr).find("td:eq(2)").text(), toDt: $(tr).find("td:eq(3)").text(), totalDays: $(tr).find("td:eq(4)").text(), halfdayflag: !1, remarks: $(tr).find("td:eq(5)").text(), additionalRemarks: $(tr).find("td:eq(6)").text() } }), TableData.shift(), jsonObj.yearMonth = yearmonth, jsonObj.leaveAppId = 0, jsonObj.empUnqId = $("#myEmpUnqId").val(), jsonObj.compCode = $("#myCompCode").val(), jsonObj.wrkGrp = $("#myWrkGrp").val(), jsonObj.unitCode = $("#myUnitCode").val(), jsonObj.deptCode = $("#myDeptCode").val(), jsonObj.statCode = $("#myStatCode").val(), jsonObj.catCode = $("#myCatCode").val(), jsonObj.isHOD = $("#myIsHod").val(), jsonObj.releaseGroupCode = $("#releaseGroupCode").val(), jsonObj.releaseStrategy = "", jsonObj.releaseStatusCode = "", jsonObj.addDt = dt, jsonObj.addUser = $("#myEmpUnqId").val(), jsonObj.clientIp = $("#myIPAddress").val(), jsonObj.updDt = dt, jsonObj.updUser = null, jsonObj.remarks = null, jsonObj.parentId = 0, jsonObj.leaveApplicationDetails = TableData, jsonObj } var d = new Date, dt = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate() + " " + d.getHours() + ":" + d.getMinutes(), year = d.getFullYear().toString(), month = d.getMonth() + 1, yearmonth = year + month.toString(), jsonObj = {}, TableData = storeTblValues(); TableData = JSON.stringify(TableData); var xhr = new XMLHttpRequest; xhr.open("POST", $scope._Conpath + "LeaveApplication/CreateLeaveApplication", !0), xhr.setRequestHeader("Content-type", "application/json"), xhr.onreadystatechange = function () { if (4 === xhr.readyState && 201 === xhr.status) { document.getElementById("MessageBox").innerHTML = "<div class='alert alert-success alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Leave Application Created Sucesfully.. </strong></div>", $("#MessageBox").show(); var json = JSON.parse(xhr.responseText), maildata = []; maildata = json; var relsdata = []; relsdata = maildata.applReleaseStatus; var relsauth = relsdata[0].releaseAuth, rlsmail = new XMLHttpRequest; rlsmail.open("GET", $scope._Conpath + "AutoMail/SendMail?releaseGroupCode=" + maildata.releaseGroupCode + "&id=" + maildata.leaveAppId + "&releaseAuth=" + relsauth, !0), rlsmail.setRequestHeader("Content-type", "application/json"), rlsmail.send(), $("#aliasTable").find("tr:not(:first)").remove(), document.getElementById("FromDt").value = "", document.getElementById("ToDt").value = "", document.getElementById("TotalDays").value = "", document.getElementById("AdditionalRemarks").value = "", $("#Remarks option:first").attr("selected", !0) } else document.getElementById("MessageBox").innerHTML = "<div class='alert alert-danger alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Leave Application Not Created.. </strong></div>", $("#MessageBox").show(), document.getElementById("FromDt").value = "", document.getElementById("ToDt").value = "", document.getElementById("TotalDays").value = "", document.getElementById("AdditionalRemarks").value = "", $("#Remarks option:first").attr("selected", !0) }, xhr.send(TableData) };
}]);
myApp.directive("datepicker", function () { return { restrict: "A", require: "ngModel", link: function (scope, elem, attrs, ngModelCtrl) { var updateModel = function (dateText) { scope.$apply(function () { ngModelCtrl.$setViewValue(dateText) }) }, options = { dateFormat: "yy-mm-dd", onSelect: function (dateText) { updateModel(dateText) } }; elem.datepicker(options) } } });